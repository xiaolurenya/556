<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人导航页</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#0ea5e9',
                        accent: '#f97316',
                        dark: '#1e293b',
                        light: '#f8fafc',
                        'text-primary': '#ffffff',
                        'text-secondary': '#cbd5e1',
                        'card-bg': 'rgba(255, 255, 255, 0.1)',
                        'card-hover': 'rgba(255, 255, 255, 0.2)',
                        'bg-overlay': 'rgba(0, 0, 0, 0.3)',
                        'bg-blur': 'rgba(255, 255, 255, 0.1)',
                        'icon-primary': '#3b82f6',
                        'sidebar-bg': 'rgba(30, 41, 59, 0.7)',
                        'sidebar-text': '#94a3b8',
                        'sidebar-text-hover': '#e2e8f0',
                        'sidebar-item-active': 'rgba(59, 130, 246, 0.2)',
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                background-color: theme('colors.bg-blur');
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
                background-color: theme('colors.card-hover');
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
            .btn-secondary {
                @apply bg-secondary hover:bg-secondary/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
            .btn-accent {
                @apply bg-accent hover:bg-accent/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
            .custom-select {
                @apply bg-white/20 border border-white/30 text-white rounded-lg appearance-none;
            }
            .custom-select:focus {
                @apply outline-none ring-2 ring-primary/50;
            }
            .custom-select option {
                @apply bg-dark text-white;
            }
            .image-overlay {
                background-color: theme('colors.bg-overlay');
            }
            .hover-scale {
                transition: transform 0.3s ease;
            }
            .hover-scale:hover {
                transform: scale(1.1);
            }
            .hover-glow {
                transition: all 0.3s ease;
            }
            .hover-glow:hover {
                filter: drop-shadow(0 0 8px rgba(37, 99, 235, 0.6));
            }
            .icon-hover {
                transition: all 0.3s ease;
            }
            .icon-hover:hover {
                transform: scale(1.2);
                filter: drop-shadow(0 0 8px rgba(37, 99, 235, 0.6));
            }
            .text-hover {
                transition: all 0.3s ease;
            }
            .text-hover:hover {
                transform: translateY(2px);
                color: theme('colors.text-primary');
            }
            .sidebar {
                @apply bg-sidebar-bg text-sidebar-text rounded-xl shadow-lg;
            }
            .sidebar-item {
                @apply block py-2 px-3 rounded-lg transition-all hover:bg-sidebar-item-active hover:text-sidebar-text-hover;
            }
            .sidebar-item.active {
                @apply bg-sidebar-item-active text-sidebar-text-hover;
            }
            .sidebar-title {
                @apply text-lg font-bold mb-4 pb-2 border-b border-white/20 text-text-primary;
            }
        }
    </style>
</head>
<body class="font-inter min-h-screen bg-cover bg-center bg-no-repeat image-overlay">
    <div id="debugWarning" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
        禁止调试
    </div>

    <div id="mainContent" class="flex-1 flex flex-col">
        <header class="glass-effect shadow-md">
            <div class="container mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center mb-4 md:mb-0">
                        <h1 class="text-2xl font-bold tracking-tight text-text-primary">个人导航页</h1>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="outerNetBtn" class="btn-primary flex items-center hover-glow">
                            <i class="fa fa-globe mr-2"></i>外网
                        </button>
                        <button id="innerNetBtn" class="btn-secondary flex items-center hover-glow">
                            <i class="fa fa-server mr-2"></i>内网
                        </button>
                        <button onclick="changeBackground()" class="btn-accent flex items-center hover-glow">
                            <i class="fa fa-image mr-2"></i>更换背景
                        </button>
                        <button onclick="openImportModal()" class="btn-secondary flex items-center hover-glow">
                            <i class="fa fa-upload mr-2"></i>导入书签
                        </button>
                        <button onclick="openAddLinkModal()" class="btn-primary flex items-center hover-glow">
                            <i class="fa fa-plus mr-2"></i>添加链接
                        </button>
                        <button onclick="openCustomBgModal()" class="btn-secondary flex items-center hover-glow">
                            <i class="fa fa-cog mr-2"></i>背景设置
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <section class="glass-effect py-6 mb-6">
            <div class="container mx-auto px-4">
                <h2 class="text-2xl font-bold mb-4 text-center text-text-primary">个人书签，上网如此简单！</h2>
                <div class="max-w-2xl mx-auto">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="search-input" placeholder="输入关键词搜索" class="flex-1 px-4 py-3 rounded-l-lg sm:rounded-r-none bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                        <select id="search-engine" class="custom-select px-4 py-3 border-y border-white/30">
                            <option value="https://www.baidu.com/s?wd=">百度</option>
                            <option value="https://cn.bing.com/search?q=">必应</option>
                            <option value="https://search.bilibili.com/all?keyword=">B站</option>
                            <option value="https://www.google.com/search?q=">谷歌</option>
                        </select>
                        <button onclick="search()" class="btn-primary rounded-r-lg sm:rounded-l-none hover-glow">
                            <i class="fa fa-search mr-2"></i>搜索
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <main class="flex-1 container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
            <aside class="w-full md:w-64 shrink-0">
                <div class="sidebar p-4">
                    <h3 class="sidebar-title">导航分类</h3>
                    <ul class="space-y-2">
                        <li><a href="#" onclick="filterLinks('all')" class="sidebar-item">
                            <i class="fa fa-th-large mr-2"></i>全部
                        </a></li>
                        <li><a href="#" onclick="filterLinks('news-information')" class="sidebar-item">
                            <i class="fa fa-bullhorn mr-2"></i>飞牛系统
                        </a></li>
                        <li><a href="#" onclick="filterLinks('learning-education')" class="sidebar-item">
                            <i class="fa fa-book mr-2"></i>热门书签
                        </a></li>
                        <li><a href="#" onclick="filterLinks('life-service')" class="sidebar-item">
                            <i class="fa fa-life-ring mr-2"></i>其他书签
                        </a></li>
                        <li><a href="#" onclick="filterLinks('imported')" class="sidebar-item">
                            <i class="fa fa-bookmark mr-2"></i>导入书签
                        </a></li>
                        <li><a href="#" onclick="openTechDigitalLogin()" class="sidebar-item">
                            <i class="fa fa-lock mr-2"></i>私人区域
                        </a></li>
                    </ul>
                </div>
            </aside>

            <section class="flex-1">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div id="linksContainer" class="col-span-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    </div>
                </div>
            </section>
        </main>

        <footer class="glass-effect py-4 mt-6">
            <div class="container mx-auto px-4 text-center text-white/70 text-sm">
                <p>© 2025-2026 个人导航页 | <a href="https://beian.miit.gov.cn/" target="_blank" class="underline hover-scale">皖ICP备2023023534号</a></p>
            </div>
        </footer>
    </div>

    <div id="techDigitalLoginContainer" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center text-text-primary">请输入私人区域密码</h2>
            <div class="space-y-4">
                <input type="password" id="techDigitalPasswordInput" placeholder="密码" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                <div class="flex gap-3">
                    <button onclick="checkTechDigitalPassword()" class="btn-primary flex-1 hover-glow">登录</button>
                    <button onclick="cancelTechDigitalLogin()" class="btn-secondary flex-1 hover-glow">取消</button>
                </div>
                <div id="techDigitalPasswordError" class="text-red-500 text-center hidden">密码错误，请重新输入！</div>
            </div>
        </div>
    </div>

    <div id="importModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center text-text-primary">导入浏览器书签</h2>
            <div class="space-y-4">
                <p class="text-center text-text-secondary">请将浏览器导出的书签HTML文件拖放到下方区域，或点击选择文件</p>
                <div id="dropArea" class="border-2 border-dashed border-white/30 rounded-lg p-6 text-center cursor-pointer hover:border-primary transition-colors hover-scale">
                    <i class="fa fa-cloud-upload text-4xl mb-2 text-text-secondary"></i>
                    <p class="text-text-secondary">拖放文件到此处，或</p>
                    <input type="file" id="fileInput" class="hidden" accept=".html,.htm">
                    <button onclick="document.getElementById('fileInput').click()" class="btn-primary mt-2 hover-glow">选择文件</button>
                </div>
                <div id="importStatus" class="hidden">
                    <div class="bg-primary/20 rounded-lg p-4">
                        <div id="importProgress" class="w-full bg-white/20 rounded-full h-2">
                            <div class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="importMessage" class="text-center mt-2 text-text-secondary">正在导入...</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeImportModal()" class="btn-secondary flex-1 hover-glow">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="addLinkModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center text-text-primary">添加新链接</h2>
            <div class="space-y-4">
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">链接名称</label>
                    <input type="text" id="linkName" placeholder="例如：百度" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white hover-scale">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">外网地址</label>
                    <input type="url" id="outerUrl" placeholder="例如：https://www.baidu.com" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white hover-scale">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">内网地址</label>
                    <input type="url" id="innerUrl" placeholder="例如：http://192.168.1.100" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white hover-scale">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">图标</label>
                    <div class="flex gap-2 flex-wrap">
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-globe"><i class="fa fa-globe"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-book"><i class="fa fa-book"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-music"><i class="fa fa-music"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-film"><i class="fa fa-film"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-gamepad"><i class="fa fa-gamepad"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-shopping-cart"><i class="fa fa-shopping-cart"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-envelope"><i class="fa fa-envelope"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-wrench"><i class="fa fa-wrench"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-cog"><i class="fa fa-cog"></i></button>
                        <button type="button" class="icon-btn bg-card-bg hover:bg-card-hover hover-scale" data-icon="fa-link"><i class="fa fa-link"></i></button>
                    </div>
                    <input type="hidden" id="selectedIcon" value="fa-link">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">分类</label>
                    <select id="linkCategory" class="custom-select w-full px-4 py-3 hover-scale">
                        <option value="news-information">飞牛系统</option>
                        <option value="learning-education">热门书签</option>
                        <option value="life-service">其他书签</option>
                        <option value="tech-digital">私人区域</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">图标颜色</label>
                    <div class="flex gap-2 flex-wrap">
                        <button type="button" class="icon-color-btn bg-blue-500 hover:bg-blue-600 w-8 h-8 rounded-full hover-scale" data-color="fa-blue"></button>
                        <button type="button" class="icon-color-btn bg-green-500 hover:bg-green-600 w-8 h-8 rounded-full hover-scale" data-color="fa-green"></button>
                        <button type="button" class="icon-color-btn bg-yellow-500 hover:bg-yellow-600 w-8 h-8 rounded-full hover-scale" data-color="fa-yellow"></button>
                        <button type="button" class="icon-color-btn bg-red-500 hover:bg-red-600 w-8 h-8 rounded-full hover-scale" data-color="fa-red"></button>
                        <button type="button" class="icon-color-btn bg-purple-500 hover:bg-purple-600 w-8 h-8 rounded-full hover-scale" data-color="fa-purple"></button>
                        <button type="button" class="icon-color-btn bg-pink-500 hover:bg-pink-600 w-8 h-8 rounded-full hover-scale" data-color="fa-pink"></button>
                        <button type="button" class="icon-color-btn bg-indigo-500 hover:bg-indigo-600 w-8 h-8 rounded-full hover-scale" data-color="fa-indigo"></button>
                        <button type="button" class="icon-color-btn bg-teal-500 hover:bg-teal-600 w-8 h-8 rounded-full hover-scale" data-color="fa-teal"></button>
                        <button type="button" class="icon-color-btn bg-amber-500 hover:bg-amber-600 w-8 h-8 rounded-full hover-scale" data-color="fa-amber"></button>
                        <button type="button" class="icon-color-btn bg-white hover:bg-gray-200 w-8 h-8 rounded-full hover-scale" data-color="fa-white"></button>
                    </div>
                    <input type="hidden" id="selectedIconColor" value="fa-blue">
                </div>
                <div class="flex gap-3">
                    <button onclick="addNewLink()" class="btn-primary flex-1 hover-glow">添加</button>
                    <button onclick="closeAddLinkModal()" class="btn-secondary flex-1 hover-glow">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="customBgModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center text-text-primary">自定义背景图片</h2>
            <div class="space-y-4">
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">图片URL</label>
                    <input type="url" id="customBgUrl" placeholder="输入图片URL地址" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white hover-scale">
                </div>
                <div class="flex gap-3">
                    <button onclick="addCustomBackground()" class="btn-primary flex-1 hover-glow">添加</button>
                    <button onclick="closeCustomBgModal()" class="btn-secondary flex-1 hover-glow">取消</button>
                </div>
                <div id="customBgList" class="mt-4">
                    <h3 class="text-lg font-semibold mb-2 text-text-primary">已添加的背景</h3>
                    <div id="bgListContainer" class="space-y-2">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 配置常量
        const CONFIG = {
            techDigitalPassword: '654321',
            passwordSaveDuration: 7 * 24 * 60 * 60 * 1000,
            defaultBackgrounds: [
                'https://shuiyin.org/assets/img/web-background.jpg',
                'https://picsum.photos/1920/1080?random=1',
                'https://picsum.photos/1920/1080?random=2',
                'https://picsum.photos/1920/1080?random=3',
            ]
        };

        // 状态管理
        const state = {
            isOuterNet: true,
            currentBgIndex: 0,
            bgUrls: JSON.parse(localStorage.getItem('customBgUrls')) || CONFIG.defaultBackgrounds,
            isFirstLoad: JSON.parse(localStorage.getItem('customBgUrls')) === null,
            importedLinks: JSON.parse(localStorage.getItem('importedLinks')) || [],
            isTechDigitalAuthenticated: false,
            selectedIcon: 'fa-link',
            selectedIconColor: 'fa-blue'
        };

        // 元素选择器
        const elements = {
            mainContent: document.getElementById('mainContent'),
            debugWarning: document.getElementById('debugWarning'),
            searchInput: document.getElementById('search-input'),
            searchEngine: document.getElementById('search-engine'),
            outerNetBtn: document.getElementById('outerNetBtn'),
            innerNetBtn: document.getElementById('innerNetBtn'),
            linksContainer: document.getElementById('linksContainer'),
            techDigitalLoginContainer: document.getElementById('techDigitalLoginContainer'),
            techDigitalPasswordInput: document.getElementById('techDigitalPasswordInput'),
            techDigitalPasswordError: document.getElementById('techDigitalPasswordError'),
            importModal: document.getElementById('importModal'),
            dropArea: document.getElementById('dropArea'),
            fileInput: document.getElementById('fileInput'),
            importStatus: document.getElementById('importStatus'),
            importProgress: document.getElementById('importProgress').querySelector('div'),
            importMessage: document.getElementById('importMessage'),
            addLinkModal: document.getElementById('addLinkModal'),
            linkName: document.getElementById('linkName'),
            outerUrl: document.getElementById('outerUrl'),
            innerUrl: document.getElementById('innerUrl'),
            selectedIcon: document.getElementById('selectedIcon'),
            selectedIconColor: document.getElementById('selectedIconColor'),
            linkCategory: document.getElementById('linkCategory'),
            iconButtons: document.querySelectorAll('.icon-btn'),
            iconColorButtons: document.querySelectorAll('.icon-color-btn'),
            customBgModal: document.getElementById('customBgModal'),
            customBgUrl: document.getElementById('customBgUrl'),
            bgListContainer: document.getElementById('bgListContainer')
        };

        // 书签链接数据
        const linkData = {
            'news-information': [
                { name: 'MoviePilot', icon: 'fa-film', color: 'fa-blue', outer: 'https://mp.li0580.top:4356', inner: 'http://192.168.2.225:3000' },
                { name: '飞牛OS', icon: 'fa-desktop', color: 'fa-green', outer: 'https://fn.li0580.top:4356', inner: 'http://192.168.2.225:5666' },
                { name: 'Alist', icon: 'fa-list', color: 'fa-yellow', outer: 'https://al.li0580.top:4356', inner: 'http://192.168.2.225:5244' },
                { name: '道理鱼', icon: 'fa-file-pdf', color: 'fa-red', outer: 'https://dly.li0580.top:4356', inner: 'http://192.168.2.225:5173' },
                { name: 'sqmusic', icon: 'fa-film', color: 'fa-red', outer: 'https://sq.li0580.top:4356', inner: 'http://192.168.2.225:8996' },
            ],
            'learning-education': [
                { name: '蜂巢', icon: 'fa-hive', color: 'fa-purple', outer: 'https://pting.club/', inner: 'https://pting.club/' },
                { name: '清和IPTV', icon: 'fa-wifi', color: 'fa-pink', outer: 'http://li0580.top:4356', inner: 'http://192.168.2.225:15760' },
                { name: 'Github', icon: 'fa-github', color: 'fa-indigo', outer: 'https://github.com/', inner: 'https://github.com/' },
                { name: 'Cloudflare', icon: 'fa-cloud', color: 'fa-teal', outer: 'https://dash.cloudflare.com', inner: 'https://dash.cloudflare.com' },
                { name: '奇节点', icon: 'fa-server', color: 'fa-amber', outer: 'https://xn--clouds-o43k.com/', inner: 'https://xn--clouds-o43k.com/' },
                { name: '花海IPTV', icon: 'fa-television', color: 'fa-blue', outer: 'http://max.token.iptv.xin:2052/login', inner: 'http://max.token.iptv.xin:2052/login' },
            ],
            'life-service': [
                { name: 'QB下载器', icon: 'fa-money-bill', color: 'fa-purple', outer: 'https://qb.li0580.top:4356', inner: 'http://192.168.2.225:8085' },
                { name: 'MDC别野刮削', icon: 'fa-money-bill', color: 'fa-purple', outer: 'https://mdc.li0580.top:4356', inner: 'http://192.168.2.225:3009' },
                { name: 'voce.chat', icon: 'fa-plane', color: 'fa-green', outer: 'https://vc.li0580.top:4356', inner: 'http://192.168.2.225:3009' },
                { name: 'IYUU辅种', icon: 'fa-envelope', color: 'fa-yellow', outer: 'https://iyuu.li0580.top:4356', inner: 'http://192.168.2.225:8780' },
                { name: '微信通知', icon: 'fa-car', color: 'fa-pink', outer: 'https://wx.li0580.top:4356', inner: 'http://192.168.2.225:3210' }
            ],
            'tech-digital': [
                { name: 'Luckyweb', icon: 'fa-play', color: 'fa-indigo', outer: 'https://xunilucky.li0580.top:16601/liwenfei', inner: 'http://192.168.2.3:16601/liwenfei/' },
                { name: '雷池WAF', icon: 'fa-play', color: 'fa-indigo', outer: 'https://leichi.li0580.top:4356', inner: 'https://192.168.2.3:9443/' },
                { name: '1panel', icon: 'fa-tv', color: 'fa-teal', outer: 'https://1panel.li0580.top:4356', inner: 'http://192.168.2.3:11908' },
                { name: '飞牛影视', icon: 'fa-film', color: 'fa-amber', outer: 'http://tv.li0580.top:4356/v/logi/', inner: 'http://192.168.2.225:8000/v/logi' },
                { name: 'EMBY', icon: 'fa-video', color: 'fa-blue', outer: 'http://li0580.top:4356', inner: 'http://192.168.2.225:8096/' },
                { name: '家园', icon: 'fa-home', color: 'fa-green', outer: 'https://hdhome.org/', inner: 'https://hdhome.org/' },
                { name: '我堡', icon: 'fa-fort-awesome', color: 'fa-yellow', outer: 'https://ourbits.club/', inner: 'https://ourbits.club/' },
                { name: '馒头', icon: 'fa-bread-slice', color: 'fa-red', outer: 'https://kp.m-team.cc/', inner: 'https://kp.m-team.cc/' },
                { name: '人人', icon: 'fa-users', color: 'fa-purple', outer: 'https://audiences.me/', inner: 'https://audiences.me/' },
                { name: '彩虹岛', icon: 'fa-rainbow', color: 'fa-pink', outer: 'https://ptchdbits.co', inner: 'https://ptchdbits.co' },
                { name: '末日', icon: 'fa-skull', color: 'fa-indigo', outer: 'https://www.agsvpt.com', inner: 'https://www.agsvpt.com' },
                { name: '海胆', icon: 'fa-water', color: 'fa-teal', outer: 'https://www.haidan.video', inner: 'https://www.haidan.video' },
                { name: '麒麟', icon: 'fa-star', color: 'fa-amber', outer: 'https://www.hdkyl.in/', inner: 'https://www.hdkyl.in/' },
                { name: '聆音', icon: 'fa-music', color: 'fa-blue', outer: 'https://pt.soulvoice.club/', inner: 'https://pt.soulvoice.club/' },
                { name: '学校', icon: 'fa-school', color: 'fa-green', outer: 'https://pt.btschool.club/', inner: 'https://pt.btschool.club/' },
                { name: 'HD高清', icon: 'fa-video', color: 'fa-yellow', outer: 'https://hdtime.org/', inner: 'https://hdtime.org/' },
                { name: '雨', icon: 'fa-cloud-rain', color: 'fa-red', outer: 'https://raingfh.top/', inner: 'https://raingfh.top/' },
                { name: '织梦', icon: 'fa-dream', color: 'fa-purple', outer: 'https://zmpt.cc/', inner: 'https://zmpt.cc/' },
                { name: '象岛', icon: 'fa-elephant', color: 'fa-pink', outer: 'https://ptvicomo.net/', inner: 'https://ptvicomo.net/' }
            ],
            'imported': state.importedLinks
        };

        // 工具函数
        const utils = {
            saveToLocalStorage(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                } catch (e) {
                    console.error('Failed to save to localStorage:', e);
                }
            },
            getFromLocalStorage(key) {
                try {
                    return JSON.parse(localStorage.getItem(key));
                } catch (e) {
                    console.error('Failed to get from localStorage:', e);
                    return null;
                }
            },
            createLinkCard(link, category) {
                const card = document.createElement('div');
                card.className = `glass-effect rounded-xl p-4 shadow-lg card-hover link-card ${category}`;
                
                const anchor = document.createElement('a');
                anchor.href = state.isOuterNet ? link.outer : link.inner;
                anchor.target = '_blank';
                anchor.className = 'flex flex-col items-center justify-center text-center h-full relative';
                anchor.dataset.outer = link.outer || link.href;
                anchor.dataset.inner = link.inner || link.href;
                
                const icon = document.createElement('i');
                icon.className = `fa ${link.icon || 'fa-link'} text-3xl mb-2 icon-hover ${getIconColorClass(link.color)}`;
                
                const name = document.createElement('span');
                name.textContent = link.name;
                name.className = 'text-hover text-text-secondary';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'absolute top-2 right-2 text-white/60 hover:text-white transition-colors hover-scale';
                deleteBtn.innerHTML = '<i class="fa fa-times"></i>';
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    if (confirm(`确定要删除 "${link.name}" 吗？`)) {
                        deleteLink(link, category);
                    }
                };
                
                anchor.appendChild(icon);
                anchor.appendChild(name);
                card.appendChild(anchor);
                card.appendChild(deleteBtn);
                
                return card;
            },
            detectLinkIcon(url) {
                const hostname = new URL(url).hostname.toLowerCase();
                if (hostname.includes('github')) return 'fa-github';
                if (hostname.includes('youtube')) return 'fa-youtube';
                if (hostname.includes('twitter')) return 'fa-twitter';
                if (hostname.includes('facebook')) return 'fa-facebook';
                if (hostname.includes('linkedin')) return 'fa-linkedin';
                if (hostname.includes('instagram')) return 'fa-instagram';
                if (hostname.includes('stackoverflow')) return 'fa-stack-overflow';
                if (hostname.includes('google')) return 'fa-google';
                if (hostname.includes('bilibili')) return 'fa-play-circle';
                if (hostname.includes('mail')) return 'fa-envelope';
                if (hostname.includes('blog')) return 'fa-blog';
                if (hostname.includes('shop')) return 'fa-shopping-cart';
                if (hostname.includes('news')) return 'fa-newspaper';
                return 'fa-link';
            },
            createBgItem(url, index) {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-2 bg-card-bg rounded-lg hover:bg-card-hover transition-colors';
                
                const img = document.createElement('img');
                img.src = url;
                img.className = 'w-12 h-8 object-cover rounded mr-2';
                img.onerror = function() {
                    this.src = 'https://picsum.photos/120/80?random=' + index;
                };
                
                const text = document.createElement('span');
                text.textContent = `背景 ${index + 1}`;
                text.className = 'text-text-secondary';
                
                const buttons = document.createElement('div');
                buttons.className = 'flex gap-2';
                
                const useBtn = document.createElement('button');
                useBtn.className = 'text-xs bg-primary/80 hover:bg-primary text-white px-2 py-1 rounded transition-colors';
                useBtn.textContent = '使用';
                useBtn.onclick = () => setBackground(index);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-xs bg-red-500/80 hover:bg-red-500 text-white px-2 py-1 rounded transition-colors';
                deleteBtn.textContent = '删除';
                deleteBtn.onclick = () => removeBackground(index);
                
                buttons.appendChild(useBtn);
                buttons.appendChild(deleteBtn);
                
                item.appendChild(img);
                item.appendChild(text);
                item.appendChild(buttons);
                
                return item;
            }
        };

        // 获取图标颜色类名
        function getIconColorClass(color) {
            const colorMap = {
                'fa-blue': 'text-blue-400',
                'fa-green': 'text-green-400',
                'fa-yellow': 'text-yellow-400',
                'fa-red': 'text-red-400',
                'fa-purple': 'text-purple-400',
                'fa-pink': 'text-pink-400',
                'fa-indigo': 'text-indigo-400',
                'fa-teal': 'text-teal-400',
                'fa-amber': 'text-amber-400',
                'fa-white': 'text-white'
            };
            
            return colorMap[color] || 'text-primary';
        }

        // 搜索功能
        function search() {
            const input = elements.searchInput.value.trim();
            const engine = elements.searchEngine.value;
            
            if (input) {
                const url = engine + encodeURIComponent(input);
                window.open(url, '_blank');
            }
        }

        // 打开私人区域登录
        function openTechDigitalLogin() {
            if (state.isTechDigitalAuthenticated) {
                filterLinks('tech-digital');
            } else {
                elements.techDigitalLoginContainer.classList.remove('hidden');
                elements.techDigitalPasswordInput.focus();
            }
        }

        // 检查私人区域密码
        function checkTechDigitalPassword() {
            const password = elements.techDigitalPasswordInput.value.trim();
            if (password === CONFIG.techDigitalPassword) {
                state.isTechDigitalAuthenticated = true;
                elements.techDigitalLoginContainer.classList.add('hidden');
                elements.techDigitalPasswordError.classList.add('hidden');
                filterLinks('tech-digital');
                
                // 保存登录状态
                localStorage.setItem('techDigitalAuth', JSON.stringify({
                    authenticated: true,
                    expireTime: Date.now() + CONFIG.passwordSaveDuration
                }));
            } else {
                elements.techDigitalPasswordError.classList.remove('hidden');
                elements.techDigitalPasswordInput.focus();
            }
        }

        // 取消私人区域登录
        function cancelTechDigitalLogin() {
            elements.techDigitalLoginContainer.classList.add('hidden');
            elements.techDigitalPasswordError.classList.add('hidden');
            elements.techDigitalPasswordInput.value = '';
        }

        // 过滤链接
        function filterLinks(category) {
            elements.linksContainer.innerHTML = '';
            
            if (category === 'all') {
                // 显示所有分类（排除私人区域，除非已认证）
                Object.keys(linkData).forEach(cat => {
                    if (cat === 'tech-digital' && !state.isTechDigitalAuthenticated) return;
                    linkData[cat].forEach(link => {
                        elements.linksContainer.appendChild(utils.createLinkCard(link, cat));
                    });
                });
            } else if (category === 'tech-digital' && !state.isTechDigitalAuthenticated) {
                openTechDigitalLogin();
            } else {
                // 显示指定分类
                linkData[category].forEach(link => {
                    elements.linksContainer.appendChild(utils.createLinkCard(link, category));
                });
            }
        }

        // 切换内外网
        function toggleNetType(isOuter) {
            state.isOuterNet = isOuter;
            elements.outerNetBtn.classList.toggle('btn-primary', isOuter);
            elements.outerNetBtn.classList.toggle('btn-secondary', !isOuter);
            elements.innerNetBtn.classList.toggle('btn-secondary', isOuter);
            elements.innerNetBtn.classList.toggle('btn-primary', !isOuter);
            
            // 更新所有链接的地址
            document.querySelectorAll('.link-card a').forEach(anchor => {
                anchor.href = isOuter ? anchor.dataset.outer : anchor.dataset.inner;
            });
        }

        // 初始化内外网切换按钮
        elements.outerNetBtn.addEventListener('click', () => toggleNetType(true));
        elements.innerNetBtn.addEventListener('click', () => toggleNetType(false));

        // 打开导入书签弹窗
        function openImportModal() {
            elements.importModal.classList.remove('hidden');
        }

        // 关闭导入书签弹窗
        function closeImportModal() {
            elements.importModal.classList.add('hidden');
            elements.fileInput.value = '';
            elements.importStatus.classList.add('hidden');
            elements.importProgress.style.width = '0%';
        }

        // 打开添加链接弹窗
        function openAddLinkModal() {
            elements.addLinkModal.classList.remove('hidden');
            elements.linkName.focus();
            
            // 重置表单
            elements.linkName.value = '';
            elements.outerUrl.value = '';
            elements.innerUrl.value = '';
            elements.selectedIcon.value = 'fa-link';
            elements.selectedIconColor.value = 'fa-blue';
            elements.linkCategory.value = 'news-information';
            
            // 重置图标和颜色按钮样式
            elements.iconButtons.forEach(btn => btn.classList.remove('bg-primary/50'));
            elements.iconColorButtons.forEach(btn => btn.classList.remove('ring-2', 'ring-white'));
            
            // 高亮默认选中项
            Array.from(elements.iconButtons).find(btn => btn.dataset.icon === 'fa-link').classList.add('bg-primary/50');
            Array.from(elements.iconColorButtons).find(btn => btn.dataset.color === 'fa-blue').classList.add('ring-2', 'ring-white');
        }

        // 关闭添加链接弹窗
        function closeAddLinkModal() {
            elements.addLinkModal.classList.add('hidden');
        }

        // 添加新链接
        function addNewLink() {
            const name = elements.linkName.value.trim();
            const outerUrl = elements.outerUrl.value.trim();
            const innerUrl = elements.innerUrl.value.trim();
            const category = elements.linkCategory.value;
            const icon = elements.selectedIcon.value;
            const color = elements.selectedIconColor.value;
            
            if (!name || (!outerUrl && !innerUrl)) {
                alert('请填写链接名称和至少一个地址');
                return;
            }
            
            const newLink = {
                name: name,
                icon: icon,
                color: color,
                outer: outerUrl,
                inner: innerUrl || outerUrl
            };
            
            // 添加到对应分类
            linkData[category].push(newLink);
            
            // 如果是导入分类，保存到本地存储
            if (category === 'imported') {
                state.importedLinks.push(newLink);
                utils.saveToLocalStorage('importedLinks', state.importedLinks);
            }
            
            // 刷新链接列表
            filterLinks(category);
            closeAddLinkModal();
        }

        // 打开自定义背景弹窗
        function openCustomBgModal() {
            elements.customBgModal.classList.remove('hidden');
            elements.customBgUrl.focus();
            renderBgList();
        }

        // 关闭自定义背景弹窗
        function closeCustomBgModal() {
            elements.customBgModal.classList.add('hidden');
            elements.customBgUrl.value = '';
        }

        // 添加自定义背景
        function addCustomBackground() {
            const url = elements.customBgUrl.value.trim();
            if (!url) {
                alert('请输入有效的图片URL');
                return;
            }
            
            state.bgUrls.push(url);
            utils.saveToLocalStorage('customBgUrls', state.bgUrls);
            renderBgList();
            elements.customBgUrl.value = '';
        }

        // 渲染背景列表
        function renderBgList() {
            elements.bgListContainer.innerHTML = '';
            state.bgUrls.forEach((url, index) => {
                elements.bgListContainer.appendChild(utils.createBgItem(url, index));
            });
        }

        // 设置背景
        function setBackground(index) {
            if (index >= 0 && index < state.bgUrls.length) {
                state.currentBgIndex = index;
                document.body.style.backgroundImage = `url(${state.bgUrls[index]})`;
                utils.saveToLocalStorage('currentBgIndex', index);
            }
        }

        // 更换背景
        function changeBackground() {
            let newIndex = (state.currentBgIndex + 1) % state.bgUrls.length;
            setBackground(newIndex);
        }

        // 移除背景
        function removeBackground(index) {
            if (state.bgUrls.length <= 1) {
                alert('至少保留一张背景图片');
                return;
            }
            
            state.bgUrls.splice(index, 1);
            utils.saveToLocalStorage('customBgUrls', state.bgUrls);
            
            // 如果删除的是当前使用的背景，切换到第一张
            if (index === state.currentBgIndex) {
                setBackground(0);
            } else if (index < state.currentBgIndex) {
                state.currentBgIndex--;
            }
            
            renderBgList();
        }

        // 删除链接
        function deleteLink(link, category) {
            const index = linkData[category].findIndex(item => item.name === link.name && item.outer === link.outer);
            if (index > -1) {
                linkData[category].splice(index, 1);
                
                // 如果是导入分类，同步到本地存储
                if (category === 'imported') {
                    state.importedLinks = linkData.imported;
                    utils.saveToLocalStorage('importedLinks', state.importedLinks);
                }
                
                // 刷新列表
                filterLinks(category);
            }
        }

        // 初始化图标选择
        elements.iconButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                elements.iconButtons.forEach(b => b.classList.remove('bg-primary/50'));
                this.classList.add('bg-primary/50');
                elements.selectedIcon.value = this.dataset.icon;
            });
        });

        // 初始化颜色选择
        elements.iconColorButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                elements.iconColorButtons.forEach(b => b.classList.remove('ring-2', 'ring-white'));
                this.classList.add('ring-2', 'ring-white');
                elements.selectedIconColor.value = this.dataset.color;
            });
        });

        // 初始化拖放导入
        elements.dropArea.addEventListener('click', () => elements.fileInput.click());
        elements.dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.dropArea.classList.add('border-primary');
        });
        elements.dropArea.addEventListener('dragleave', () => {
            elements.dropArea.classList.remove('border-primary');
        });
        elements.dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.dropArea.classList.remove('border-primary');
            if (e.dataTransfer.files.length) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });
        elements.fileInput.addEventListener('change', () => {
            if (elements.fileInput.files.length) {
                handleFileUpload(elements.fileInput.files[0]);
            }
        });

        // 处理文件上传
        function handleFileUpload(file) {
            if (!file.name.endsWith('.html') && !file.name.endsWith('.htm')) {
                alert('请上传HTML格式的书签文件');
                return;
            }
            
            elements.importStatus.classList.remove('hidden');
            elements.importProgress.style.width = '20%';
            elements.importMessage.textContent = '正在解析文件...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                elements.importProgress.style.width = '50%';
                elements.importMessage.textContent = '正在提取书签...';
                
                try {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(e.target.result, 'text/html');
                    const links = doc.querySelectorAll('a');
                    const importedLinks = [];
                    
                    links.forEach((link, index) => {
                        const href = link.getAttribute('href');
                        const name = link.textContent.trim() || '未命名链接';
                        
                        if (href && !href.startsWith('javascript')) {
                            importedLinks.push({
                                name: name,
                                icon: utils.detectLinkIcon(href),
                                color: 'fa-blue',
                                outer: href,
                                inner: href
                            });
                            
                            // 更新进度
                            const progress = 50 + (index / links.length) * 40;
                            elements.importProgress.style.width = `${progress}%`;
                        }
                    });
                    
                    // 添加到导入分类
                    state.importedLinks = [...state.importedLinks, ...importedLinks];
                    linkData.imported = state.importedLinks;
                    utils.saveToLocalStorage('importedLinks', state.importedLinks);
                    
                    elements.importProgress.style.width = '100%';
                    elements.importMessage.textContent = `成功导入 ${importedLinks.length} 个书签`;
                    
                    // 3秒后关闭弹窗
                    setTimeout(() => {
                        closeImportModal();
                        filterLinks('imported');
                    }, 2000);
                    
                } catch (error) {
                    console.error('导入失败:', error);
                    elements.importMessage.textContent = '导入失败：' + error.message;
                }
            };
            
            reader.readAsText(file);
        }

        // 检查登录状态
        function checkAuthStatus() {
            const authData = JSON.parse(localStorage.getItem('techDigitalAuth'));
            if (authData && authData.authenticated && authData.expireTime > Date.now()) {
                state.isTechDigitalAuthenticated = true;
            } else {
                state.isTechDigitalAuthenticated = false;
                localStorage.removeItem('techDigitalAuth');
            }
        }

        // 初始化页面
        function initPage() {
            // 检查认证状态
            checkAuthStatus();
            
            // 设置背景
            const savedIndex = parseInt(localStorage.getItem('currentBgIndex')) || 0;
            state.currentBgIndex = savedIndex < state.bgUrls.length ? savedIndex : 0;
            document.body.style.backgroundImage = `url(${state.bgUrls[state.currentBgIndex]})`;
            
            // 初始化显示所有链接
            filterLinks('all');
            
            // 高亮默认图标和颜色按钮
            Array.from(elements.iconButtons).find(btn => btn.dataset.icon === 'fa-link').classList.add('bg-primary/50');
            Array.from(elements.iconColorButtons).find(btn => btn.dataset.color === 'fa-blue').classList.add('ring-2', 'ring-white');
            
            // 阻止调试
            window.addEventListener('devtoolschange', function(e) {
                if (e.detail.open) {
                    elements.debugWarning.classList.remove('hidden');
                    setTimeout(() => {
                        elements.debugWarning.classList.add('hidden');
                    }, 3000);
                }
            });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
