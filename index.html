<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人导航页</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script>
        // 配置Tailwind自定义主题
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#0ea5e9',
                        accent: '#f97316',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                background-color: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(16px);
                -webkit-backdrop-filter: blur(16px);
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            }
            .btn-primary {
                @apply bg-primary hover:bg-primary/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
            .btn-secondary {
                @apply bg-secondary hover:bg-secondary/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
            .btn-accent {
                @apply bg-accent hover:bg-accent/90 text-white font-semibold py-2 px-4 rounded transition-all duration-300 transform hover:scale-105;
            }
        }
    </style>
</head>
<body class="font-inter min-h-screen bg-cover bg-center bg-no-repeat">
    <!-- 调试警告 -->
    <div id="debugWarning" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
        禁止调试
    </div>

    <!-- 主内容区域 -->
    <div id="mainContent" class="flex-1 flex flex-col">
        <!-- 顶部导航栏 -->
        <header class="glass-effect shadow-md">
            <div class="container mx-auto px-4 py-3">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex items-center mb-4 md:mb-0">
                        <h1 class="text-2xl font-bold tracking-tight">个人导航页</h1>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button id="outerNetBtn" class="btn-primary flex items-center">
                            <i class="fa fa-globe mr-2"></i>外网
                        </button>
                        <button id="innerNetBtn" class="btn-secondary flex items-center">
                            <i class="fa fa-server mr-2"></i>内网
                        </button>
                        <button onclick="changeBackground()" class="btn-accent flex items-center">
                            <i class="fa fa-image mr-2"></i>更换背景
                        </button>
                        <button onclick="openImportModal()" class="btn-secondary flex items-center">
                            <i class="fa fa-upload mr-2"></i>导入书签
                        </button>
                        <button onclick="openAddLinkModal()" class="btn-primary flex items-center">
                            <i class="fa fa-plus mr-2"></i>添加链接
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- 搜索区域 -->
        <section class="glass-effect py-6 mb-6">
            <div class="container mx-auto px-4">
                <h2 class="text-2xl font-bold mb-4 text-center">个人书签，上网如此简单！</h2>
                <div class="max-w-2xl mx-auto">
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="search-input" placeholder="输入关键词搜索" class="flex-1 px-4 py-3 rounded-l-lg sm:rounded-r-none bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                        <select id="search-engine" class="px-4 py-3 bg-white/20 border-y border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white appearance-none relative">
                            <option value="https://www.baidu.com/s?wd=">百度</option>
                            <option value="https://cn.bing.com/search?q=">必应</option>
                            <option value="https://search.bilibili.com/all?keyword=">B站</option>
                            <option value="https://www.google.com/search?q=">谷歌</option>
                        </select>
                        <button onclick="search()" class="btn-primary rounded-r-lg sm:rounded-l-none">
                            <i class="fa fa-search mr-2"></i>搜索
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 主内容区 -->
        <main class="flex-1 container mx-auto px-4 py-6 flex flex-col md:flex-row gap-6">
            <!-- 侧边栏导航 -->
            <aside class="w-full md:w-64 shrink-0">
                <div class="glass-effect rounded-xl p-4 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 pb-2 border-b border-white/20">导航分类</h3>
                    <ul class="space-y-2">
                        <li><a href="#" onclick="filterLinks('all')" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-th-large mr-2"></i>全部
                        </a></li>
                        <li><a href="#" onclick="filterLinks('news-information')" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-bullhorn mr-2"></i>飞牛系统
                        </a></li>
                        <li><a href="#" onclick="filterLinks('learning-education')" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-book mr-2"></i>热门书签
                        </a></li>
                        <li><a href="#" onclick="filterLinks('life-service')" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-life-ring mr-2"></i>其他书签
                        </a></li>
                        <li><a href="#" onclick="filterLinks('imported')" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-bookmark mr-2"></i>导入书签
                        </a></li>
                        <li><a href="#" onclick="openTechDigitalLogin()" class="block py-2 px-3 rounded-lg hover:bg-white/20 transition-all">
                            <i class="fa fa-lock mr-2"></i>私人区域
                        </a></li>
                    </ul>
                </div>
            </aside>

            <!-- 书签展示区 -->
            <section class="flex-1">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <div id="linksContainer" class="col-span-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- 书签卡片将通过JavaScript动态生成 -->
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="glass-effect py-4 mt-6">
            <div class="container mx-auto px-4 text-center text-white/70 text-sm">
                <p>© 2023 个人导航页 | <a href="https://beian.miit.gov.cn/" target="_blank" class="underline">皖ICP备2023023534号</a></p>
            </div>
        </footer>
    </div>

    <!-- 私人区域登录模态框 -->
    <div id="techDigitalLoginContainer" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center">请输入私人区域密码</h2>
            <div class="space-y-4">
                <input type="password" id="techDigitalPasswordInput" placeholder="密码" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                <div class="flex gap-3">
                    <button onclick="checkTechDigitalPassword()" class="btn-primary flex-1">登录</button>
                    <button onclick="cancelTechDigitalLogin()" class="btn-secondary flex-1">取消</button>
                </div>
                <div id="techDigitalPasswordError" class="text-red-500 text-center hidden">密码错误，请重新输入！</div>
            </div>
        </div>
    </div>

    <!-- 导入书签模态框 -->
    <div id="importModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center">导入浏览器书签</h2>
            <div class="space-y-4">
                <p class="text-center">请将浏览器导出的书签HTML文件拖放到下方区域，或点击选择文件</p>
                <div id="dropArea" class="border-2 border-dashed border-white/30 rounded-lg p-6 text-center cursor-pointer hover:border-primary transition-colors">
                    <i class="fa fa-cloud-upload text-4xl mb-2"></i>
                    <p>拖放文件到此处，或</p>
                    <input type="file" id="fileInput" class="hidden" accept=".html,.htm">
                    <button onclick="document.getElementById('fileInput').click()" class="btn-primary mt-2">选择文件</button>
                </div>
                <div id="importStatus" class="hidden">
                    <div class="bg-primary/20 rounded-lg p-4">
                        <div id="importProgress" class="w-full bg-white/20 rounded-full h-2">
                            <div class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                        </div>
                        <p id="importMessage" class="text-center mt-2">正在导入...</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="closeImportModal()" class="btn-secondary flex-1">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加链接模态框 -->
    <div id="addLinkModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 hidden">
        <div class="glass-effect rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all">
            <h2 class="text-2xl font-bold mb-6 text-center">添加新链接</h2>
            <div class="space-y-4">
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">链接名称</label>
                    <input type="text" id="linkName" placeholder="例如：百度" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">外网地址</label>
                    <input type="url" id="outerUrl" placeholder="例如：https://www.baidu.com" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">内网地址</label>
                    <input type="url" id="innerUrl" placeholder="例如：http://192.168.1.100" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">图标</label>
                    <div class="flex gap-2 flex-wrap">
                        <button type="button" class="icon-btn" data-icon="fa-globe"><i class="fa fa-globe"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-book"><i class="fa fa-book"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-music"><i class="fa fa-music"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-film"><i class="fa fa-film"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-gamepad"><i class="fa fa-gamepad"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-shopping-cart"><i class="fa fa-shopping-cart"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-envelope"><i class="fa fa-envelope"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-wrench"><i class="fa fa-wrench"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-cog"><i class="fa fa-cog"></i></button>
                        <button type="button" class="icon-btn" data-icon="fa-link"><i class="fa fa-link"></i></button>
                    </div>
                    <input type="hidden" id="selectedIcon" value="fa-link">
                </div>
                <div>
                    <label class="block mb-2 text-sm font-medium text-white/80">分类</label>
                    <select id="linkCategory" class="w-full px-4 py-3 rounded-lg bg-white/20 border border-white/30 focus:outline-none focus:ring-2 focus:ring-primary/50 text-white">
                        <option value="news-information">飞牛系统</option>
                        <option value="learning-education">热门书签</option>
                        <option value="life-service">其他书签</option>
                        <option value="tech-digital">私人区域</option>
                    </select>
                </div>
                <div class="flex gap-3">
                    <button onclick="addNewLink()" class="btn-primary flex-1">添加</button>
                    <button onclick="closeAddLinkModal()" class="btn-secondary flex-1">取消</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 配置信息
        const CONFIG = {
            techDigitalPassword: '654321',
            passwordSaveDuration: 7 * 24 * 60 * 60 * 1000,
            defaultBackgrounds: [
                'https://picsum.photos/1920/1080?random=1',
                'https://picsum.photos/1920/1080?random=2',
                'https://picsum.photos/1920/1080?random=3'
            ]
        };

        // 应用状态
        const state = {
            currentBgIndex: 0,
            isOuterNet: true,
            customBgUrls: JSON.parse(localStorage.getItem('customBgUrls')) || CONFIG.defaultBackgrounds,
            isFirstBgChange: JSON.parse(localStorage.getItem('customBgUrls')) === null,
            importedLinks: JSON.parse(localStorage.getItem('importedLinks')) || [],
            isTechDigitalAuthenticated: false,
            selectedIcon: 'fa-link'
        };

        // DOM元素
        const elements = {
            mainContent: document.getElementById('mainContent'),
            debugWarning: document.getElementById('debugWarning'),
            searchInput: document.getElementById('search-input'),
            searchEngine: document.getElementById('search-engine'),
            outerNetBtn: document.getElementById('outerNetBtn'),
            innerNetBtn: document.getElementById('innerNetBtn'),
            linksContainer: document.getElementById('linksContainer'),
            techDigitalLoginContainer: document.getElementById('techDigitalLoginContainer'),
            techDigitalPasswordInput: document.getElementById('techDigitalPasswordInput'),
            techDigitalPasswordError: document.getElementById('techDigitalPasswordError'),
            importModal: document.getElementById('importModal'),
            dropArea: document.getElementById('dropArea'),
            fileInput: document.getElementById('fileInput'),
            importStatus: document.getElementById('importStatus'),
            importProgress: document.getElementById('importProgress').querySelector('div'),
            importMessage: document.getElementById('importMessage'),
            addLinkModal: document.getElementById('addLinkModal'),
            linkName: document.getElementById('linkName'),
            outerUrl: document.getElementById('outerUrl'),
            innerUrl: document.getElementById('innerUrl'),
            selectedIcon: document.getElementById('selectedIcon'),
            linkCategory: document.getElementById('linkCategory'),
            iconButtons: document.querySelectorAll('.icon-btn')
        };

        // 书签数据
        const linkData = {
            'news-information': [
                { name: 'MoviePilot', icon: 'fa-film', outer: 'http://li0580.top:3000', inner: 'http://192.168.2.225:3000' },
                { name: '飞牛OS', icon: 'fa-desktop', outer: 'http://li0580.top:8000', inner: 'http://192.168.2.225:8000' },
                { name: 'Alist', icon: 'fa-list', outer: 'http://li0580.top:5244', inner: 'http://192.168.2.225:5244' },
                { name: 'PDF工具箱', icon: 'fa-file-pdf', outer: 'http://li0580.top:3615', inner: '192.168.2.225:3615' },
            ],
            'learning-education': [
                { name: '蜂巢', icon: 'fa-hive', outer: 'https://pting.club/', inner: 'https://pting.club/' },
                { name: '爱快路由器', icon: 'fa-wifi', outer: 'http://li0580.top:2025', inner: 'http://192.168.2.225:2025/' },
                { name: 'Github', icon: 'fa-github', outer: 'https://github.com/', inner: 'https://github.com/' },
                { name: 'Cloudflare', icon: 'fa-cloud', outer: 'https://dash.cloudflare.com', inner: 'https://dash.cloudflare.com' },
                { name: '奇节点', icon: 'fa-server', outer: 'https://xn--clouds-o43k.com/', inner: 'https://xn--clouds-o43k.com/' },
                { name: '花海IPTV', icon: 'fa-television', outer: 'http://max.token.iptv.xin:2052/login', inner: 'http://max.token.iptv.xin:2052/login' },
            ],
            'life-service': [
                { name: '美团', icon: 'fa-utensils', outer: 'https://www.meituan.com/', inner: 'https://www.meituan.com/' },
                { name: '饿了么', icon: 'fa-hamburger', outer: 'https://www.ele.me/', inner: 'https://www.ele.me/' },
                { name: '携程旅行', icon: 'fa-plane', outer: 'https://www.ctrip.com/', inner: 'https://www.ctrip.com/' },
                { name: '网易邮箱', icon: 'fa-envelope', outer: 'https://email.163.com/', inner: 'https://email.163.com/' },
                { name: '支付宝', icon: 'fa-money-bill', outer: 'https://www.alipay.com/', inner: 'https://www.alipay.com/' },
                { name: '滴滴出行', icon: 'fa-car', outer: 'https://www.didiglobal.com/', inner: 'https://www.didiglobal.com/' }
            ],
            'tech-digital': [
                { name: 'libretv', icon: 'fa-play', outer: 'https://libretv-3x4.pages.dev', inner: 'https://libretv-3x4.pages.dev' },
                { name: 'nullbr', icon: 'fa-tv', outer: 'https://nullbr.online/', inner: 'https://nullbr.online/' },
                { name: '飞牛影视', icon: 'fa-film', outer: 'http://li0580.top:8000/v/logi/', inner: 'http://192.168.2.225:8000/v/logi' },
                { name: 'EMBY', icon: 'fa-video', outer: 'http://li0580.top:8096', inner: 'http://192.168.2.225:8096/' },
                { name: '家园', icon: 'fa-home', outer: 'https://hdhome.org/', inner: 'https://hdhome.org/' },
                { name: '我堡', icon: 'fa-fort-awesome', outer: 'https://ourbits.club/', inner: 'https://ourbits.club/' },
                { name: '馒头', icon: 'fa-bread-slice', outer: 'https://kp.m-team.cc/', inner: 'https://kp.m-team.cc/' },
                { name: '人人', icon: 'fa-users', outer: 'https://audiences.me/', inner: 'https://audiences.me/' },
                { name: '彩虹岛', icon: 'fa-rainbow', outer: 'https://ptchdbits.co', inner: 'https://ptchdbits.co' },
                { name: '末日', icon: 'fa-skull', outer: 'https://www.agsvpt.com', inner: 'https://www.agsvpt.com' },
                { name: '海胆', icon: 'fa-sea', outer: 'https://www.haidan.video', inner: 'https://www.haidan.video' },
                { name: 'HDfans', icon: 'fa-star', outer: 'https://www.hdkyl.in/', inner: 'https://www.hdkyl.in/' },
                { name: '聆音', icon: 'fa-music', outer: 'https://pt.soulvoice.club/', inner: 'https://pt.soulvoice.club/' },
                { name: '学校', icon: 'fa-school', outer: 'https://pt.btschool.club/', inner: 'https://pt.btschool.club/' },
                { name: 'HD高清', icon: 'fa-video', outer: 'https://hdtime.org/', inner: 'https://hdtime.org/' },
                { name: '雨', icon: 'fa-cloud-rain', outer: 'https://raingfh.top/', inner: 'https://raingfh.top/' },
                { name: '织梦', icon: 'fa-dream', outer: 'https://zmpt.cc/', inner: 'https://zmpt.cc/' },
                { name: '象岛', icon: 'fa-elephant', outer: 'https://ptvicomo.net/', inner: 'https://ptvicomo.net/' }
            ],
            'imported': state.importedLinks
        };

        // 工具函数
        const utils = {
            saveToLocalStorage(key, value) {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    console.error('Failed to save to localStorage:', e);
                }
            },
            getFromLocalStorage(key) {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.error('Failed to get from localStorage:', e);
                    return null;
                }
            },
            createLinkCard(link, category) {
                const card = document.createElement('div');
                card.className = `glass-effect rounded-xl p-4 shadow-lg card-hover link-card ${category}`;
                
                const anchor = document.createElement('a');
                anchor.href = state.isOuterNet ? link.outer : link.inner;
                anchor.target = '_blank';
                anchor.className = 'flex flex-col items-center justify-center text-center h-full';
                anchor.dataset.outer = link.outer || link.href;
                anchor.dataset.inner = link.inner || link.href;
                
                const icon = document.createElement('i');
                icon.className = `fa ${link.icon || 'fa-link'} text-3xl mb-2`;
                
                const name = document.createElement('span');
                name.textContent = link.name;
                
                // 添加删除按钮
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'absolute top-2 right-2 text-white/60 hover:text-white transition-colors';
                deleteBtn.innerHTML = '<i class="fa fa-times"></i>';
                deleteBtn.onclick = function(e) {
                    e.stopPropagation();
                    if (confirm(`确定要删除 "${link.name}" 吗？`)) {
                        deleteLink(link, category);
                    }
                };
                
                anchor.appendChild(icon);
                anchor.appendChild(name);
                card.appendChild(anchor);
                card.appendChild(deleteBtn);
                
                return card;
            },
            detectLinkIcon(url) {
                const hostname = new URL(url).hostname.toLowerCase();
                if (hostname.includes('github')) return 'fa-github';
                if (hostname.includes('youtube')) return 'fa-youtube';
                if (hostname.includes('twitter')) return 'fa-twitter';
                if (hostname.includes('facebook')) return 'fa-facebook';
                if (hostname.includes('linkedin')) return 'fa-linkedin';
                if (hostname.includes('instagram')) return 'fa-instagram';
                if (hostname.includes('stackoverflow')) return 'fa-stack-overflow';
                if (hostname.includes('google')) return 'fa-google';
                if (hostname.includes('bilibili')) return 'fa-play-circle';
                if (hostname.includes('mail')) return 'fa-envelope';
                if (hostname.includes('blog')) return 'fa-blog';
                if (hostname.includes('shop')) return 'fa-shopping-cart';
                if (hostname.includes('news')) return 'fa-newspaper';
                return 'fa-link';
            }
        };

        // 功能模块
        const modules = {
            auth: {
                checkTechDigitalPassword() {
                    const password = elements.techDigitalPasswordInput.value;
                    
                    if (password === CONFIG.techDigitalPassword) {
                        elements.techDigitalPasswordError.classList.add('hidden');
                        elements.techDigitalLoginContainer.classList.add('hidden');
                        elements.techDigitalPasswordInput.value = '';
                        state.isTechDigitalAuthenticated = true;
                        
                        // 保存认证状态到localStorage
                        const authExpiry = new Date().getTime() + CONFIG.passwordSaveDuration;
                        localStorage.setItem('techDigitalAuthenticated', JSON.stringify({
                            authenticated: true,
                            expiry: authExpiry
                        }));
                        
                        // 重新加载所有链接并显示私人区域
                        modules.links.populateLinks();
                        modules.links.filterLinks('tech-digital');
                        alert('成功进入私人区域！');
                    } else {
                        elements.techDigitalPasswordError.classList.remove('hidden');
                        elements.techDigitalPasswordInput.classList.add('border-red-500');
                        setTimeout(() => {
                            elements.techDigitalPasswordInput.classList.remove('border-red-500');
                        }, 2000);
                    }
                },
                cancelTechDigitalLogin() {
                    elements.techDigitalLoginContainer.classList.add('hidden');
                    elements.techDigitalPasswordInput.value = '';
                    // 如果取消登录，返回到全部视图
                    modules.links.filterLinks('all');
                },
                checkSavedAuthentication() {
                    // 检查是否有保存的认证状态
                    const savedAuth = localStorage.getItem('techDigitalAuthenticated');
                    if (savedAuth) {
                        try {
                            const authData = JSON.parse(savedAuth);
                            if (authData.authenticated && authData.expiry > new Date().getTime()) {
                                state.isTechDigitalAuthenticated = true;
                            } else {
                                // 认证已过期，删除保存的状态
                                localStorage.removeItem('techDigitalAuthenticated');
                            }
                        } catch (e) {
                            console.error('Failed to parse authentication data:', e);
                            localStorage.removeItem('techDigitalAuthenticated');
                        }
                    }
                }
            },
            security: {
                preventDebugging() {
                    const threshold = 160;
                    
                    function detectDebug() {
                        if (window.outerWidth - window.innerWidth > threshold || 
                            window.outerHeight - window.innerHeight > threshold) {
                            elements.debugWarning.classList.remove('hidden');
                        } else {
                            elements.debugWarning.classList.add('hidden');
                        }
                    }
                    
                    window.addEventListener('resize', detectDebug);
                    setInterval(detectDebug, 1000);
                    
                    document.addEventListener('contextmenu', e => e.preventDefault());
                    
                    document.addEventListener('keydown', e => {
                        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && 
                            (e.key === 'I' || e.key === 'J' || e.key === 'C'))) {
                            e.preventDefault();
                            elements.debugWarning.classList.remove('hidden');
                        }
                    });
                }
            },
            search: {
                performSearch() {
                    const input = elements.searchInput.value.trim();
                    const engine = elements.searchEngine.value;
                    
                    if (input) {
                        const url = engine + encodeURIComponent(input);
                        window.open(url, '_blank');
                    }
                }
            },
            network: {
                switchToOuterNet() {
                    if (!state.isOuterNet) {
                        document.querySelectorAll('.link-card a').forEach(link => {
                            link.href = link.dataset.outer;
                        });
                        state.isOuterNet = true;
                        elements.outerNetBtn.classList.add('bg-primary');
                        elements.outerNetBtn.classList.remove('bg-secondary');
                        elements.innerNetBtn.classList.add('bg-secondary');
                        elements.innerNetBtn.classList.remove('bg-primary');
                    }
                },
                switchToInnerNet() {
                    if (state.isOuterNet) {
                        document.querySelectorAll('.link-card a').forEach(link => {
                            link.href = link.dataset.inner;
                        });
                        state.isOuterNet = false;
                        elements.outerNetBtn.classList.remove('bg-primary');
                        elements.outerNetBtn.classList.add('bg-secondary');
                        elements.innerNetBtn.classList.remove('bg-secondary');
                        elements.innerNetBtn.classList.add('bg-primary');
                    }
                }
            },
            links: {
                populateLinks() {
                    elements.linksContainer.innerHTML = '';
                    
                    for (const category in linkData) {
                        // 只有认证后才显示tech-digital分类
                        if (category === 'tech-digital' && !state.isTechDigitalAuthenticated) continue;
                        
                        linkData[category].forEach(link => {
                            const card = utils.createLinkCard(link, category);
                            elements.linksContainer.appendChild(card);
                        });
                    }
                },
                filterLinks(category) {
                    const cards = document.querySelectorAll('.link-card');
                    
                    cards.forEach(card => {
                        if (category === 'all') {
                            // 如果是全部，隐藏未认证的tech-digital
                            if (card.classList.contains('tech-digital') && !state.isTechDigitalAuthenticated) {
                                card.classList.add('hidden');
                            } else {
                                card.classList.remove('hidden');
                            }
                        } else if (card.classList.contains(category)) {
                            // 如果是tech-digital但未认证，则隐藏
                            if (category === 'tech-digital' && !state.isTechDigitalAuthenticated) {
                                card.classList.add('hidden');
                            } else {
                                card.classList.remove('hidden');
                            }
                        } else {
                            card.classList.add('hidden');
                        }
                    });
                    
                    // 高亮当前选中的分类
                    document.querySelectorAll('.glass-effect ul a').forEach(link => {
                        link.classList.remove('bg-white/20');
                    });
                    
                    if (category === 'all') {
                        document.querySelector('.glass-effect ul a:first-child').classList.add('bg-white/20');
                    } else {
                        document.querySelector(`.glass-effect ul a[onclick="filterLinks('${category}')"]`).classList.add('bg-white/20');
                    }
                }
            },
            background: {
                changeBackground() {
                    // 修复更换背景问题：确保有自定义背景
                    if (state.customBgUrls.length === 0) {
                        state.customBgUrls = CONFIG.defaultBackgrounds;
                    }
                    
                    // 修复更换背景问题：正确循环背景
                    state.currentBgIndex = (state.currentBgIndex + 1) % state.customBgUrls.length;
                    
                    // 修复更换背景问题：应用新背景
                    document.body.style.backgroundImage = `url('${state.customBgUrls[state.currentBgIndex]}')`;
                    
                    // 保存背景设置
                    utils.saveToLocalStorage('customBgUrls', JSON.stringify(state.customBgUrls));
                },
                initBackground() {
                    if (state.customBgUrls.length > 0) {
                        state.currentBgIndex = Math.floor(Math.random() * state.customBgUrls.length);
                        document.body.style.backgroundImage = `url('${state.customBgUrls[state.currentBgIndex]}')`;
                    }
                }
            },
            import: {
                openImportModal() {
                    elements.importModal.classList.remove('hidden');
                },
                closeImportModal() {
                    elements.importModal.classList.add('hidden');
                    elements.importStatus.classList.add('hidden');
                    elements.fileInput.value = '';
                },
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    elements.importStatus.classList.remove('hidden');
                    elements.importMessage.textContent = '正在解析书签文件...';
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const content = e.target.result;
                            const links = modules.import.parseBookmarks(content);
                            
                            elements.importMessage.textContent = '正在导入书签...';
                            elements.importProgress.style.width = '50%';
                            
                            setTimeout(() => {
                                modules.import.processImportedLinks(links);
                                elements.importProgress.style.width = '100%';
                                elements.importMessage.textContent = `成功导入 ${links.length} 个书签！`;
                                
                                setTimeout(() => {
                                    modules.import.closeImportModal();
                                    modules.links.populateLinks();
                                    modules.links.filterLinks('imported');
                                    alert(`成功导入 ${links.length} 个书签！`);
                                }, 1000);
                            }, 1000);
                        } catch (error) {
                            console.error('Error parsing bookmarks:', error);
                            elements.importMessage.textContent = '解析书签文件失败，请检查文件格式！';
                            elements.importProgress.style.width = '0%';
                            elements.importProgress.classList.add('bg-red-500');
                            
                            setTimeout(() => {
                                elements.importProgress.classList.remove('bg-red-500');
                                modules.import.closeImportModal();
                            }, 2000);
                        }
                    };
                    
                    reader.readAsText(file);
                },
                parseBookmarks(content) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    const links = [];
                    
                    // 处理标准的Chrome/Firefox书签导出格式
                    const linkElements = doc.querySelectorAll('a');
                    linkElements.forEach((a, index) => {
                        const href = a.getAttribute('href');
                        const name = a.textContent.trim() || `书签 ${index + 1}`;
                        
                        if (href) {
                            links.push({
                                name: name,
                                href: href,
                                icon: utils.detectLinkIcon(href),
                                outer: href,
                                inner: href
                            });
                        }
                    });
                    
                    return links;
                },
                processImportedLinks(links) {
                    state.importedLinks = links;
                    linkData.imported = links;
                    utils.saveToLocalStorage('importedLinks', JSON.stringify(links));
                }
            },
            linksManagement: {
                addLink(name, outerUrl, innerUrl, icon, category) {
                    // 检查是否已存在同名链接
                    for (const cat in linkData) {
                        const existingLink = linkData[cat].find(link => link.name === name);
                        if (existingLink) {
                            return false;
                        }
                    }
                    
                    // 添加新链接
                    const newLink = {
                        name,
                        outer: outerUrl,
                        inner: innerUrl || outerUrl,
                        icon
                    };
                    
                    linkData[category].push(newLink);
                    
                    // 保存到localStorage
                    if (category === 'imported') {
                        state.importedLinks = linkData.imported;
                        utils.saveToLocalStorage('importedLinks', JSON.stringify(state.importedLinks));
                    } else {
                        // 对于其他分类，我们也保存到localStorage
                        utils.saveToLocalStorage('customLinks', JSON.stringify(linkData));
                    }
                    
                    return true;
                },
                deleteLink(link, category) {
                    // 从数组中删除链接
                    linkData[category] = linkData[category].filter(item => item.name !== link.name);
                    
                    // 更新localStorage
                    if (category === 'imported') {
                        state.importedLinks = linkData.imported;
                        utils.saveToLocalStorage('importedLinks', JSON.stringify(state.importedLinks));
                    } else {
                        utils.saveToLocalStorage('customLinks', JSON.stringify(linkData));
                    }
                    
                    // 重新渲染链接
                    modules.links.populateLinks();
                    
                    return true;
                }
            }
        };

        // 全局函数 - 暴露给HTML的事件处理
        function search() {
            modules.search.performSearch();
        }
        
        function filterLinks(category) {
            modules.links.filterLinks(category);
        }
        
        function changeBackground() {
            modules.background.changeBackground();
        }
        
        function openImportModal() {
            modules.import.openImportModal();
        }
        
        function closeImportModal() {
            modules.import.closeImportModal();
        }
        
        function openTechDigitalLogin() {
            if (!state.isTechDigitalAuthenticated) {
                elements.techDigitalLoginContainer.classList.remove('hidden');
            } else {
                // 如果已认证，直接显示私人区域
                modules.links.filterLinks('tech-digital');
            }
        }
        
        function checkTechDigitalPassword() {
            modules.auth.checkTechDigitalPassword();
        }
        
        function cancelTechDigitalLogin() {
            modules.auth.cancelTechDigitalLogin();
        }
        
        // 新增函数
        function openAddLinkModal() {
            // 重置表单
            elements.linkName.value = '';
            elements.outerUrl.value = '';
            elements.innerUrl.value = '';
            elements.selectedIcon.value = 'fa-link';
            elements.linkCategory.value = 'news-information';
            
            // 重置图标按钮样式
            elements.iconButtons.forEach(btn => {
                btn.classList.remove('bg-primary/50');
            });
            
            // 显示模态框
            elements.addLinkModal.classList.remove('hidden');
        }
        
        function closeAddLinkModal() {
            elements.addLinkModal.classList.add('hidden');
        }
        
        function selectIcon(icon) {
            state.selectedIcon = icon;
            elements.selectedIcon.value = icon;
            
            // 更新图标按钮样式
            elements.iconButtons.forEach(btn => {
                if (btn.dataset.icon === icon) {
                    btn.classList.add('bg-primary/50');
                } else {
                    btn.classList.remove('bg-primary/50');
                }
            });
        }
        
        function addNewLink() {
            const name = elements.linkName.value.trim();
            const outerUrl = elements.outerUrl.value.trim();
            const innerUrl = elements.innerUrl.value.trim() || outerUrl;
            const icon = elements.selectedIcon.value;
            const category = elements.linkCategory.value;
            
            // 验证
            if (!name) {
                alert('请输入链接名称');
                return;
            }
            
            if (!outerUrl) {
                alert('请输入外网地址');
                return;
            }
            
            // 尝试添加链接
            const success = modules.linksManagement.addLink(name, outerUrl, innerUrl, icon, category);
            
            if (success) {
                // 关闭模态框
                closeAddLinkModal();
                
                // 刷新链接显示
                modules.links.populateLinks();
                
                // 切换到添加的链接所在分类
                modules.links.filterLinks(category);
                
                alert(`成功添加链接 "${name}"`);
            } else {
                alert(`已存在同名链接 "${name}"`);
            }
        }
        
        function deleteLink(link, category) {
            // 检查是否需要权限
            if (category === 'tech-digital' && !state.isTechDigitalAuthenticated) {
                alert('需要先登录私人区域才能删除此分类中的链接');
                openTechDigitalLogin();
                return;
            }
            
            // 执行删除
            const success = modules.linksManagement.deleteLink(link, category);
            
            if (success) {
                alert(`成功删除链接 "${link.name}"`);
            } else {
                alert(`删除链接失败`);
            }
        }

        // 事件监听
        function setupEventListeners() {
            elements.searchInput.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                    modules.search.performSearch();
                }
            });
            
            elements.outerNetBtn.addEventListener('click', modules.network.switchToOuterNet);
            elements.innerNetBtn.addEventListener('click', modules.network.switchToInnerNet);
            
            elements.dropArea.addEventListener('dragover', e => {
                e.preventDefault();
                elements.dropArea.classList.add('border-primary');
            });
            
            elements.dropArea.addEventListener('dragleave', () => {
                elements.dropArea.classList.remove('border-primary');
            });
            
            elements.dropArea.addEventListener('drop', e => {
                e.preventDefault();
                elements.dropArea.classList.remove('border-primary');
                
                if (e.dataTransfer.files.length) {
                    elements.fileInput.files = e.dataTransfer.files;
                    modules.import.handleFileSelect({ target: elements.fileInput });
                }
            });
            
            elements.fileInput.addEventListener('change', modules.import.handleFileSelect);
            
            // 图标选择事件
            elements.iconButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    selectIcon(btn.dataset.icon);
                });
            });
            
            // 初始化图标选择
            selectIcon('fa-link');
            
            // 加载本地存储的自定义链接
            const savedCustomLinks = localStorage.getItem('customLinks');
            if (savedCustomLinks) {
                try {
                    const customLinks = JSON.parse(savedCustomLinks);
                    for (const category in customLinks) {
                        if (category !== 'imported' && Array.isArray(customLinks[category])) {
                            linkData[category] = customLinks[category];
                        }
                    }
                } catch (e) {
                    console.error('Failed to parse custom links:', e);
                }
            }
        }

        // 初始化
        function init() {
            modules.security.preventDebugging();
            modules.background.initBackground();
            
            // 检查是否有保存的认证状态
            modules.auth.checkSavedAuthentication();
            
            modules.links.populateLinks();
            setupEventListeners();
            
            // 默认显示全部书签
            modules.links.filterLinks('all');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>    
